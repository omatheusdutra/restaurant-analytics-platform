describe('env config', () => {
  const OLD = { ...process.env } as any;
  afterEach(() => { process.env = { ...OLD }; jest.resetModules(); });

  it('parses defaults and warns in development', async () => {
    process.env.NODE_ENV = 'development';
    process.env.DATABASE_URL = '';
    process.env.JWT_SECRET = '';
    const spy = jest.spyOn(console, 'warn').mockImplementation(() => undefined as any);
    const mod = await import('@/config/env');
    mod.validateEnv();
    expect(spy).toHaveBeenCalled();
    spy.mockRestore();
  });

  it('throws in production when critical envs are missing', async () => {
    process.env.NODE_ENV = 'production';
    process.env.DATABASE_URL = '';
    process.env.JWT_SECRET = '';
    const mod = await import('@/config/env');
    expect(() => mod.validateEnv()).toThrow();
  });
});

